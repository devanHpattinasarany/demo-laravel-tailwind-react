import{r,j as e,H as W,a as M,L as y}from"./app-B8tNCKAm.js";import{A as X,S as T}from"./app-layout-wgeL9kFG.js";import{S as P}from"./search-B3wyK2JY.js";import{C as D}from"./x-Cn2mDkte.js";import{U as E}from"./users-isqXScsX.js";import{T as z}from"./trending-up-B7eN6Fqe.js";import{C as V}from"./clock-C-f8qG0u.js";import{M as Y}from"./map-pin-jl5am97y.js";import{C as Z}from"./chart-column-DWKT68Cn.js";import{F as ee}from"./file-text-Df7VKwHU.js";/* empty css            */import"./button-DIsC9JQj.js";import"./index-BZy_L5cr.js";import"./index-CGp7pdP-.js";import"./index-CBVOtKq4.js";import"./index-B-7vnX3c.js";const se=[{title:"Dashboard",href:"/dashboard"},{title:"Check-in System",href:"/admin/checkin"}];function be({events:I,filters:R,statistics:g}){const[v,A]=r.useState(R.date||new Date().toISOString().split("T")[0]),[F,K]=r.useState(R.status||""),[n,f]=r.useState(""),[a,u]=r.useState([]),[p,L]=r.useState(!1),[w,c]=r.useState(!1),[m,x]=r.useState(-1),[i,l]=r.useState({type:null,message:""}),d=r.useRef(null),b=r.useRef(null),S=r.useRef(null);r.useEffect(()=>(b.current&&clearTimeout(b.current),n.trim().length>=2?b.current=setTimeout(()=>{_()},300):n.trim().length===0&&(u([]),c(!1),x(-1),l({type:null,message:""})),()=>{b.current&&clearTimeout(b.current)}),[n]);const $=r.useCallback(()=>{if(d.current&&document.activeElement!==d.current){const s=d.current.selectionStart;d.current.focus(),s!==null&&d.current.setSelectionRange(s,s)}},[]);r.useEffect(()=>{!p&&a.length>0&&$()},[a,p,$]);const _=async()=>{var s;if(console.log("handleSearch called",{searchQuery:n}),!n.trim()||n.length<2){n.length>0&&n.length<2&&l({type:"warning",message:"Masukkan minimal 2 karakter untuk pencarian"});return}L(!0),u([]),c(!1),x(-1),l({type:null,message:""});try{const t=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content,h=await fetch("/admin/checkin/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t||"",Accept:"application/json"},body:JSON.stringify({query:n})}),o=await h.json();console.log("Search response:",o),h.ok?(u(o.registrations),c(o.registrations.length>0),await B(o.registrations),o.registrations.length===0&&l({type:"warning",message:`Tidak ditemukan peserta dengan kata kunci "${n}"`})):l({type:"error",message:o.message||"Terjadi kesalahan saat mencari peserta"})}catch(t){console.error("Search error:",t),l({type:"error",message:"Terjadi kesalahan koneksi. Silakan coba lagi."})}finally{L(!1)}},B=async s=>{if(s.length===1){const t=s[0];if(t.ticket_number.toLowerCase()===n.toLowerCase()&&!t.is_checked_in){console.log("Auto check-in for exact ticket match:",t.ticket_number),await j(t.id);return}}},j=async s=>{var t;l({type:null,message:""});try{const h=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content,o=await fetch("/admin/checkin/check-in",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":h||"",Accept:"application/json"},body:JSON.stringify({registration_id:s})}),N=await o.json();console.log("Check-in response:",N),o.ok?(l({type:"success",message:N.message,data:N.data}),u(k=>k.map(C=>C.id===s?{...C,is_checked_in:!0,check_in_time:N.data.check_in_time}:C)),setTimeout(()=>{var k;f(""),u([]),c(!1),x(-1),l({type:null,message:""}),(k=d.current)==null||k.focus()},3e3)):l({type:"error",message:N.message||"Gagal melakukan check-in"})}catch(h){console.error("Check-in error:",h),l({type:"error",message:"Terjadi kesalahan koneksi. Silakan coba lagi."})}},q=s=>{if(!w||a.length===0){s.key==="Enter"&&(s.preventDefault(),_());return}switch(s.key){case"ArrowDown":s.preventDefault(),x(t=>t<a.length-1?t+1:t);break;case"ArrowUp":s.preventDefault(),x(t=>t>0?t-1:t);break;case"Enter":if(s.preventDefault(),m>=0&&m<a.length){const t=a[m];t.is_checked_in||j(t.id)}else a.length===1&&!a[0].is_checked_in&&j(a[0].id);break;case"Escape":s.preventDefault(),f(""),u([]),c(!1),x(-1),l({type:null,message:""});break;case"Tab":if(m>=0&&m<a.length){s.preventDefault();const t=a[m];f(t.ticket_number),c(!1)}else a.length>0&&(s.preventDefault(),f(a[0].ticket_number),c(!1));break}};r.useEffect(()=>{const s=t=>{S.current&&!S.current.contains(t.target)&&d.current&&!d.current.contains(t.target)&&(c(!1),x(-1))};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const U=s=>{j(s)},G=s=>{switch(s){case"success":return"âœ…";case"error":return"âŒ";case"warning":return"âš ï¸";default:return""}},J=s=>{switch(s){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return""}},Q=()=>{M.get("/admin/checkin",{date:v,status:F},{preserveState:!0,preserveScroll:!0})},O=s=>s>=80?"text-green-600 bg-green-50 border-green-200":s>=60?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",H=g.total_registrations_today>0?Math.round(g.total_checkins_today/g.total_registrations_today*100):0;return e.jsxs(X,{breadcrumbs:se,children:[e.jsx(W,{title:"Check-in System - Festival Tahuri Admin"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-6 overflow-x-auto",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-500 bg-clip-text text-transparent",children:"Check-in System"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Kelola check-in peserta untuk semua event"})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-green-600"}),"Check-in Peserta"]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{ref:d,type:"text",placeholder:"Ketik nomor tiket (BIFT001T) atau nama peserta...",value:n,onChange:s=>f(s.target.value),onKeyDown:q,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500",disabled:p,autoComplete:"off"}),w&&a.length>0&&e.jsx("div",{ref:S,className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:a.map((s,t)=>e.jsx("div",{className:`p-3 cursor-pointer border-b border-gray-100 last:border-b-0 hover:bg-green-50 transition-colors ${t===m?"bg-green-50 border-green-200":""}`,onClick:()=>{s.is_checked_in||j(s.id),c(!1)},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.full_name}),e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded font-medium",children:s.ticket_number})]}),e.jsx("div",{className:"text-sm text-gray-600",children:s.event_title})]}),e.jsx("div",{className:"ml-3",children:s.is_checked_in?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded font-medium",children:"âœ… Sudah Check-in"}):e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded font-medium",children:"â³ Klik untuk Check-in"})})]})},s.id))})]}),e.jsxs("button",{onClick:_,disabled:p||!n.trim(),className:"px-6 py-3 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 min-w-[140px]",children:[e.jsx(P,{className:"w-5 h-5"}),p?"Mencari...":"Cari & Check-in"]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 text-sm text-green-700 mt-3",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Tips:"})]}),e.jsxs("div",{className:"space-y-1 sm:space-y-0 sm:space-x-4 sm:flex",children:[e.jsx("span",{children:"â€¢ Ketik nomor tiket lengkap untuk auto check-in"}),e.jsx("span",{children:"â€¢ Gunakan â†‘â†“ untuk navigasi, Enter untuk pilih"}),e.jsx("span",{children:"â€¢ Tab untuk auto-complete, Esc untuk batal"})]})]}),i.type&&e.jsxs("div",{className:`flex items-start gap-3 p-4 border rounded-lg mt-4 transition-all duration-300 ${J(i.type)} ${i.type==="success"?"animate-pulse":""}`,children:[e.jsx("span",{className:"text-lg",children:G(i.type)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium",children:i.message}),i.data&&e.jsxs("div",{className:"text-sm mt-1 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:i.data.participant_name})," - ",i.data.ticket_number]}),e.jsxs("p",{className:"text-xs opacity-75",children:["Event: ",i.data.event_title]})]})]}),i.type==="success"&&e.jsx("div",{className:"text-2xl animate-bounce",children:"ðŸŽ‰"})]}),a.length>0&&!w&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Hasil Pencarian (",a.length,")"]}),a.map(s=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 hover:border-green-300 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-900",children:s.full_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded font-medium",children:s.ticket_number}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded font-medium",children:s.event_title}),s.is_checked_in?e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded font-medium",children:"âœ… Sudah Check-in"}):e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded font-medium",children:"â³ Belum Check-in"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["NIK: ",s.nik]}),e.jsxs("div",{children:["Telepon: ",s.phone]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:s.is_checked_in?e.jsxs("div",{className:"px-4 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium text-center",children:["âœ… Sudah Hadir",s.check_in_time&&e.jsx("div",{className:"text-xs mt-1",children:new Date(s.check_in_time).toLocaleString("id-ID")})]}):e.jsx("button",{onClick:()=>U(s.id),disabled:p,className:"w-full sm:w-auto px-4 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors",children:"âœ… Check-in Sekarang"})})]})},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-700 font-medium text-sm",children:"Event Hari Ini"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:g.total_events_today}),e.jsx("p",{className:"text-blue-600 text-sm",children:"Total event"})]}),e.jsx(D,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-200 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-700 font-medium text-sm",children:"Registrasi Hari Ini"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:g.total_registrations_today}),e.jsx("p",{className:"text-orange-600 text-sm",children:"Total peserta"})]}),e.jsx(E,{className:"w-8 h-8 text-orange-500"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-200 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-700 font-medium text-sm",children:"Check-in Hari Ini"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:g.total_checkins_today}),e.jsx("p",{className:"text-green-600 text-sm",children:"Sudah hadir"})]}),e.jsx(T,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:`bg-gradient-to-br border-2 rounded-2xl p-6 ${O(H)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Tingkat Kehadiran"}),e.jsxs("p",{className:"text-3xl font-bold",children:[H,"%"]}),e.jsx("p",{className:"text-sm",children:"Rata-rata hari ini"})]}),e.jsx(z,{className:"w-8 h-8"})]})})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-sm border border-orange-100 rounded-xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(D,{className:"w-4 h-4 inline mr-2"}),"Tanggal Event"]}),e.jsx("input",{type:"date",value:v,onChange:s=>A(s.target.value),className:"w-full px-3 sm:px-4 py-3 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status Event"}),e.jsxs("select",{value:F,onChange:s=>K(s.target.value),className:"w-full px-3 sm:px-4 py-3 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Semua Status"}),e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"inactive",children:"Tidak Aktif"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:Q,className:"flex-1 sm:flex-none px-4 sm:px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Filter"}),e.jsx("span",{className:"sm:hidden",children:"Filter"})]}),e.jsx("button",{onClick:()=>{A(new Date().toISOString().split("T")[0]),K(""),M.get("/admin/checkin")},className:"flex-1 sm:flex-none px-4 sm:px-6 py-3 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium rounded-lg transition-colors text-sm sm:text-base",children:"Reset"})]})]})}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-orange-100 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Event pada ",new Date(v).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})}),I.length>0?e.jsx("div",{className:"grid gap-4 p-6 max-h-96 overflow-y-auto",children:I.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-6 hover:border-orange-200 hover:bg-orange-50/30 transition-all duration-300",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"text-xl font-semibold text-gray-900",children:s.title}),e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded font-medium",children:s.event_code}),e.jsx("span",{className:`px-2 py-1 text-xs rounded font-medium ${s.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:s.status==="active"?"Aktif":"Tidak Aktif"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(V,{className:"w-4 h-4"}),s.time?`${s.time} WIT`:"Waktu belum ditentukan"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Y,{className:"w-4 h-4"}),s.location]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(E,{className:"w-4 h-4"}),s.registration_count," peserta terdaftar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"Terdaftar"}),e.jsx("span",{className:"font-semibold text-blue-900",children:s.registration_count})]})}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-green-700",children:"Check-in"}),e.jsx("span",{className:"font-semibold text-green-900",children:s.check_in_count})]})}),e.jsx("div",{className:`border rounded-lg p-3 ${O(s.attendance_rate)}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Tingkat Hadir"}),e.jsxs("span",{className:"font-semibold",children:[s.attendance_rate,"%"]})]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-6",children:[e.jsxs(y,{href:`/admin/registrations?event_id=${s.id}`,className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm font-medium rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Check-in Manual"]}),e.jsxs(y,{href:`/admin/seminars/${s.id}`,className:"px-4 py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 text-sm font-medium rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Detail Event"]})]})]})},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak ada event"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Tidak ada event pada tanggal yang dipilih"}),e.jsx(y,{href:"/admin/seminars/create",className:"px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-medium rounded-lg transition-colors",children:"Buat Talkshow Baru"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Aksi Cepat Check-in"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs(y,{href:"/admin/registrations",className:"p-4 bg-white border border-blue-200 rounded-lg hover:border-blue-300 hover:shadow-md transition-all duration-200 text-center group",children:[e.jsx(E,{className:"w-8 h-8 text-blue-500 mx-auto mb-2 group-hover:scale-110 transition-transform"}),e.jsx("p",{className:"font-medium text-gray-900",children:"Kelola Registrasi"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Lihat dan kelola peserta"})]}),e.jsxs(y,{href:"/admin/seminars",className:"p-4 bg-white border border-orange-200 rounded-lg hover:border-orange-300 hover:shadow-md transition-all duration-200 text-center group",children:[e.jsx(ee,{className:"w-8 h-8 text-orange-500 mx-auto mb-2 group-hover:scale-110 transition-transform"}),e.jsx("p",{className:"font-medium text-gray-900",children:"Kelola Talkshow"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Atur Talkshow dan peserta"})]})]})]})]})]})}export{be as default};
