import{r as c,j as e,H as P,L as A,a as Q}from"./app-7yJZybBn.js";import{A as K}from"./app-layout-CYfrix2W.js";import{A as F}from"./arrow-left-BF5YBiSn.js";import{C as H}from"./x-DTxrud8b.js";import{C as O}from"./clock-CuaQ3ZDr.js";import{M as $}from"./map-pin-BQnDvsae.js";import{U as z}from"./users-CQ1yYDsP.js";import{c as b}from"./button-58wN6Ggi.js";import{S as C}from"./search-B6w_NTTO.js";import{C as _}from"./circle-check-big-CluY2tyv.js";import{U as M}from"./user-check-DNnzvTWB.js";import{C as U,a as X}from"./circle-x-DNE5Gd55.js";/* empty css            */import"./index-BV0BdL2i.js";import"./index-qbK-OE_I.js";import"./index-uGYGdhW4.js";import"./index-CgeLETzg.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],E=b("Loader",B);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],J=b("QrCode",G);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],W=b("Scan",V),Y=[{title:"Dashboard",href:"/dashboard"},{title:"Check-in System",href:"/admin/checkin"},{title:"Scanner Check-in",href:"/admin/checkin/scanner"}];function pe({events:T,selectedEvent:r}){var S;const[l,R]=c.useState(((S=r==null?void 0:r.id)==null?void 0:S.toString())||""),[a,j]=c.useState(""),[p,h]=c.useState([]),[x,w]=c.useState(!1),[f,N]=c.useState("manual"),[o,t]=c.useState({type:null,message:""}),v=c.useRef(null),g=c.useRef(null);c.useEffect(()=>(g.current&&clearTimeout(g.current),a.trim().length>=2&&l?g.current=setTimeout(()=>{y()},300):a.trim().length===0&&(h([]),t({type:null,message:""})),()=>{g.current&&clearTimeout(g.current)}),[a,l]);const I=s=>{R(s),s&&Q.get("/admin/checkin/scanner",{event:s},{preserveState:!0,preserveScroll:!0})},y=async()=>{var s;if(console.log("handleSearch called",{searchQuery:a,selectedEventId:l}),!l){t({type:"warning",message:"Pilih event terlebih dahulu sebelum melakukan pencarian"});return}if(!a.trim()||a.length<2){a.length>0&&a.length<2&&t({type:"warning",message:"Masukkan minimal 2 karakter untuk pencarian"});return}w(!0),h([]),t({type:null,message:""});try{const m=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content;console.log("CSRF Token:",m);const i=await fetch("/admin/checkin/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":m||"",Accept:"application/json"},body:JSON.stringify({query:a,event_id:l||void 0})});console.log("Response status:",i.status);const n=await i.json();console.log("Response data:",n),i.ok?(h(n.registrations),console.log("Search results set:",n.registrations),n.registrations.length===0&&t({type:"warning",message:`Tidak ditemukan peserta dengan kata kunci "${a}"`})):(console.log("Response error:",n),t({type:"error",message:n.message||"Terjadi kesalahan saat mencari peserta"}))}catch(m){console.error("Search error:",m),t({type:"error",message:"Terjadi kesalahan koneksi. Silakan coba lagi."})}finally{w(!1)}},D=async s=>{var m;console.log("handleCheckIn called for registration ID:",s),t({type:null,message:""});try{const i=(m=document.querySelector('meta[name="csrf-token"]'))==null?void 0:m.content;console.log("Check-in CSRF Token:",i);const n=await fetch("/admin/checkin/check-in",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i||"",Accept:"application/json"},body:JSON.stringify({registration_id:s})});console.log("Check-in response status:",n.status);const d=await n.json();console.log("Check-in response data:",d),n.ok?(console.log("Check-in successful:",d),t({type:"success",message:d.message,data:d.data}),h(u=>u.map(k=>k.id===s?{...k,is_checked_in:!0,check_in_time:d.data.check_in_time}:k)),setTimeout(()=>{var u;j(""),h([]),t({type:null,message:""}),(u=v.current)==null||u.focus()},3e3)):(console.log("Check-in error:",d),t({type:"error",message:d.message||"Gagal melakukan check-in"}))}catch(i){console.error("Check-in error:",i),t({type:"error",message:"Terjadi kesalahan koneksi. Silakan coba lagi."})}},q=s=>{switch(s){case"success":return e.jsx(_,{className:"w-5 h-5"});case"error":return e.jsx(X,{className:"w-5 h-5"});case"warning":return e.jsx(U,{className:"w-5 h-5"});default:return null}},L=s=>{switch(s){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return""}};return e.jsxs(K,{breadcrumbs:Y,children:[e.jsx(P,{title:"Scanner Check-in - Festival Tahuri Admin"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-500 bg-clip-text text-transparent",children:"Scanner Check-in"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1 text-sm sm:text-base",children:"Scan tiket atau cari manual untuk check-in peserta"})]}),e.jsxs(A,{href:"/admin/checkin",className:"w-full sm:w-auto px-4 py-3 sm:py-2 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium rounded-lg transition-colors flex items-center justify-center sm:justify-start gap-2 text-sm sm:text-base",children:[e.jsx(F,{className:"w-4 h-4"}),"Kembali"]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-orange-100 rounded-xl p-4 sm:p-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-4",children:"Pilih Event untuk Check-in"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Event"}),e.jsxs("select",{value:l,onChange:s=>I(s.target.value),className:"w-full px-3 sm:px-4 py-3 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"",children:"Pilih Event..."}),T.map(s=>e.jsxs("option",{value:s.id,children:[s.title," - ",new Date(s.date).toLocaleDateString("id-ID")]},s.id))]})]}),r&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3 sm:p-4",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base text-orange-900 mb-2 leading-tight",children:r.title}),e.jsxs("div",{className:"space-y-1 text-xs sm:text-sm text-orange-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-3 h-3 sm:w-4 sm:h-4"}),new Date(r.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),r.time&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.time," WIT"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.location]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.check_in_count,"/",r.registration_count," check-in"]})]})]})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm border border-orange-100 rounded-xl p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-center gap-3 sm:gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>N("qr"),className:`px-4 sm:px-6 py-3 font-medium rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base ${f==="qr"?"bg-green-500 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(J,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Scan QR Code"}),e.jsx("span",{className:"sm:hidden",children:"QR Code"})]}),e.jsxs("button",{onClick:()=>N("manual"),className:`px-4 sm:px-6 py-3 font-medium rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base ${f==="manual"?"bg-blue-500 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(C,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Cari Manual"}),e.jsx("span",{className:"sm:hidden",children:"Manual"})]})]}),f==="qr"?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-gray-100 border-2 border-dashed border-gray-300 rounded-xl p-8 mb-4",children:[e.jsx(W,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"QR Code Scanner"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Fitur QR Code Scanner akan tersedia dalam versi selanjutnya"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Gunakan mode "Cari Manual" untuk sementara'})]})}):e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-4",children:"Pencarian Manual"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{ref:v,type:"text",placeholder:l?"Ketik nomor tiket, nama, NIK, email, atau telepon (auto-search)...":"Pilih event terlebih dahulu...",value:a,onChange:s=>j(s.target.value),onKeyPress:s=>s.key==="Enter"&&y(),className:"w-full px-3 sm:px-4 py-3 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",disabled:x||!l})}),e.jsxs("button",{onClick:y,disabled:x||!a.trim()||!l,className:"w-full sm:w-auto px-4 sm:px-6 py-3 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 text-sm sm:text-base",children:[x?e.jsx(E,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin"}):e.jsx(C,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{children:x?"Mencari...":"Cari Manual"})]})]}),o.type&&e.jsxs("div",{className:`flex items-start gap-2 sm:gap-3 p-3 sm:p-4 border rounded-lg mb-6 ${L(o.type)}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:q(o.type)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-medium text-sm sm:text-base leading-tight",children:o.message}),o.data&&e.jsxs("p",{className:"text-xs sm:text-sm mt-1 break-words",children:[o.data.participant_name," - ",o.data.ticket_number]})]})]}),p.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900",children:["Hasil Pencarian (",p.length,")"]}),p.map(s=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-orange-200 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-3",children:[e.jsx("h5",{className:"font-semibold text-gray-900 text-base sm:text-lg",children:s.full_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 text-xs rounded font-medium",children:s.ticket_number}),s.is_checked_in?e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded font-medium flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),"Sudah Check-in"]}):e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-700 text-xs rounded font-medium",children:"Belum Check-in"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"break-words",children:["NIK: ",s.nik]}),e.jsxs("div",{className:"break-words",children:["Telepon: ",s.phone]}),e.jsxs("div",{className:"break-words",children:["Email: ",s.email]}),e.jsxs("div",{className:"break-words",children:["Event: ",s.event_title]})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Registrasi: ",new Date(s.registration_date).toLocaleString("id-ID")]}),s.is_checked_in&&s.check_in_time&&e.jsxs("div",{children:["Check-in: ",new Date(s.check_in_time).toLocaleString("id-ID")]})]})]}),e.jsx("div",{className:"flex-shrink-0 w-full sm:w-auto",children:s.is_checked_in?e.jsxs("div",{className:"w-full sm:w-auto px-4 py-3 bg-green-100 text-green-700 rounded-lg text-sm font-medium flex items-center justify-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Sudah Hadir"]}):e.jsxs("button",{onClick:()=>D(s.id),disabled:x,className:"w-full sm:w-auto px-4 py-3 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2 text-sm",children:[e.jsx(M,{className:"w-4 h-4"}),"Check-in Sekarang"]})})]})},s.id))]})]})]})]})]})}export{pe as default};
